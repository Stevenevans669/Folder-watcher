# 文件夹监视系统 PRD

## 概述

一个轻量级桌面应用，用于监视指定文件夹的文件变化并实时记录日志。

**技术栈**：Tauri (壳) + React + Node.js (sidecar)

---

## 界面布局

```
┌─────────────────────────────────────────────────┐
│  ┌──────────────┐  ┌──────────────────────────┐ │
│  │ [+ 添加目录]  │  │  变化日志      [清空]   │ │
│  ├──────────────┤  ├──────────────────────────┤ │
│  │ /path/to/a  ×│  │ 10:23 新增 file1.txt     │ │
│  │ /path/to/b  ×│  │ 10:24 修改 config.json   │ │
│  │ /path/to/c  ×│  │ 10:25 删除 temp.log      │ │
│  │              │  │                          │ │
│  └──────────────┘  └──────────────────────────┘ │
└─────────────────────────────────────────────────┘
     左侧栏 (30%)           右侧栏 (70%)
```

---

## 功能需求

### P0 核心功能（MVP）

| 功能 | 描述 |
|------|------|
| 添加目录 | 点击按钮，打开系统文件夹选择器，选择要监视的目录 |
| 移除目录 | 每个目录右侧显示删除按钮(×)，点击移除 |
| 实时监视 | 监听文件的创建、修改、删除事件 |
| 日志显示 | 右侧面板实时显示变化记录，格式：时间 + 事件类型 + 文件路径 |
| 清空日志 | 一键清空当前日志列表 |
| 记住目录列表 | 将目录列表保存到本地，下次启动自动加载 |

### P1 后续功能

| 功能 | 描述 |
|------|------|
| 日志过滤 | 按事件类型（新增/修改/删除）筛选 |
| 日志导出 | 导出为 txt 或 csv 文件 |
| 开机自启 | 系统启动时自动运行 |

---

## 技术实现

### 前端 (WebView)

- 框架：React
- 样式：TailwindCSS

### 后端 (Node.js Sidecar)

- 文件监视：`chokidar`
- 与 Tauri 通信：stdin/stdout JSON
- 目录列表存储：JSON 文件（存放在用户数据目录）

### 数据流

```
[用户添加目录] → [前端] → [Tauri] → [Node.js 开始监听]
                                          ↓
[前端更新 UI] ← [Tauri 转发] ← [stdout JSON 事件]
```

---

## 数据结构

```typescript
// 监视目录
interface WatchedDir {
  id: string
  path: string
}

// 变化日志
interface ChangeLog {
  timestamp: number
  eventType: 'create' | 'modify' | 'delete'
  filePath: string
}
```

---

## MVP 范围

**做**：
- 添加/移除监视目录
- 实时显示文件变化日志
- 清空日志
- 记住目录列表

**不做**：
- 日志搜索
- 忽略规则
- 系统通知
- 重命名事件（复杂度高，暂不支持）

---

## 测试验收标准

### 添加目录

| # | 测试项 | 预期结果 |
|---|--------|----------|
| 1 | 点击"添加目录"按钮 | 弹出系统文件夹选择器 |
| 2 | 选择一个文件夹并确认 | 目录出现在左侧列表中 |
| 3 | 添加已存在的目录 | 提示"目录已添加"，不重复添加 |
| 4 | 取消选择 | 列表无变化 |

### 移除目录

| # | 测试项 | 预期结果 |
|---|--------|----------|
| 1 | 点击目录右侧的 × 按钮 | 目录从列表移除，停止监视该目录 |
| 2 | 移除正在产生变化的目录 | 立即停止监视，不再产生新日志 |

### 实时监视

| # | 测试项 | 预期结果 |
|---|--------|----------|
| 1 | 在监视目录中新建文件 | 日志显示：时间 + "新增" + 文件路径 |
| 2 | 修改监视目录中的文件内容 | 日志显示：时间 + "修改" + 文件路径 |
| 3 | 删除监视目录中的文件 | 日志显示：时间 + "删除" + 文件路径 |
| 4 | 在子目录中操作文件 | 同样能监听到（递归监视） |
| 5 | 同时监视多个目录 | 各目录变化都能正常记录 |

### 日志显示

| # | 测试项 | 预期结果 |
|---|--------|----------|
| 1 | 产生新日志 | 自动滚动到最新一条 |
| 2 | 日志格式 | 显示为：HH:MM:SS 事件类型 文件路径 |
| 3 | 大量日志（100+条） | 界面不卡顿，滚动流畅 |

### 清空日志

| # | 测试项 | 预期结果 |
|---|--------|----------|
| 1 | 点击"清空"按钮 | 日志列表清空 |
| 2 | 清空后继续监视 | 新变化正常记录 |

### 记住目录列表

| # | 测试项 | 预期结果 |
|---|--------|----------|
| 1 | 添加目录后关闭应用，重新打开 | 之前添加的目录仍在列表中 |
| 2 | 重启后自动开始监视 | 无需手动操作，直接监视已保存的目录 |
| 3 | 移除目录后关闭应用，重新打开 | 被移除的目录不再出现 |

### 异常场景

| # | 测试项 | 预期结果 |
|---|--------|----------|
| 1 | 监视的目录被外部删除 | 提示用户目录不存在，从列表移除 |
| 2 | 无读取权限的目录 | 添加时提示权限不足 |
| 3 | 网络挂载目录断开 | 不崩溃，给出错误提示 |

---

## 里程碑

| 阶段 | 内容 | 预估 |
|------|------|------|
| M1 | Tauri + React 项目初始化，基础 UI | 1天 |
| M2 | Node.js sidecar + chokidar 监听逻辑 | 1天 |
| M3 | 前后端联调，目录列表本地存储 | 1天 |
| M4 | 打包测试 (macOS/Windows/Linux) | 0.5天 |

**总计**：约 3.5 天

---

## 参考

- [Tauri 官方文档](https://tauri.app/)
- [Tauri Sidecar 指南](https://tauri.app/develop/sidecar/)
- [chokidar - Node.js 文件监视库](https://github.com/paulmillr/chokidar)
